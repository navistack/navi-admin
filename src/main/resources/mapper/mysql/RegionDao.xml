<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.navistack.admin.modules.common.dao.RegionDao">
    <select id="selectListRecursively" resultType="org.navistack.admin.modules.common.entity.Region">
        WITH RECURSIVE `t` AS (
            SELECT *
              FROM `region` `r`
            <where>
                <if test="ew != null
                 and ew.expression != null
                 and ew.expression.normal != null
                 and ew.expression.normal.sqlSegment != null
                 and !ew.expression.normal.sqlSegment.isEmpty()">
                    ${ew.expression.normal.sqlSegment}
                </if>
            </where>
            UNION
            SELECT `r`.*
              FROM `t`
                   CROSS JOIN `region` `r` ON `t`.`code` = `r`.`parent_code`
        )
        SELECT *
          FROM `t`
    </select>
</mapper>
